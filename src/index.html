<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Edith Path</title>

    <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,400italic,500,500italic,600,600italic,700,700italic,300italic,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,400italic,500,500italic,600,600italic,700,700italic,300italic,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Material+Icons' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/style.css?version=2.0.1" >
</head>
<body>

    <header class="bg-color-primary altitude-1">
        <h1>Edit-path</h1>
        <!--div class="window-tools bg-color-primary-dark">
            <img src="img/ic_close_white_36dp_1x.png" alt="" />
        </div-->
    </header>

    <section class="altitude-2 add-folders">
        <h2>Choisir un dossier Ã  ajouter au path</h2>

        <ul id="folders-to-add-list">
        </ul>

        <div id="holder" class="holder">
            Faites glisser votre dossier ici pour l'ajouter au path.
        </div>

        <div class="folder-input">
            <button class="btn altitude-1 bg-color-primary-dark">Valider</button>
        </div>
    </section>

    <div class="choose-folder altitude-2"></div>

    <section class="list-path altitude-2">
        <div class="section-header">
            <h2>PATH actuel</h2>
            <div class="js-refresh-list"></div>
        </div>

        <div class="loader">
            <svg class="circular" viewBox="25 25 50 50">
              <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/>
            </svg>
        </div>

        <ul id="folders-list">
        </ul>
    </section>

    <script type="text/javascript">
        'use strict';

        var ipc = require('ipc');
        var remote = require('remote');
        var dialog = remote.require('dialog');
        window.$ = window.jQuery = require('jquery');
        var foldersToAdd = [];

        document.ondragover = document.ondrop = function(e) {
          e.preventDefault();
          return false;
        };

        function addFolder(path) {
            if(path) {
                foldersToAdd.push(path);

                var folderElementHtml = $('<li/>');
                var iconHtml = $('<i/>')
                    .attr('class', 'md-icon dp48')
                    .html('check_circle');

                folderElementHtml
                    .html(path)
                    .prepend(iconHtml);

                $('#folders-to-add-list').prepend(folderElementHtml);
            }
        }

        ipc.on('data-folders', function(folders) {
            var arrayLength = folders.length;
            var foldersListHtml = $('#folders-list').empty();;

            if(arrayLength > 0) {
                for (var i = 0; i < arrayLength; i++) {
                    var folderElementHtml = $('<li/>');
                    // var iconHtml = $('<i/>')
                    //     .attr('class', 'md-icon dp48');

                    if(folders[i].isValidDirectory) {
                        // iconHtml.html('check_circle');
                        folderElementHtml.attr('class', 'valid-path');
                    } else {
                        // iconHtml.html('error');
                        folderElementHtml.attr('class', 'invalid-path');
                    }

                    folderElementHtml
                        .html(folders[i].path);
                        // .prepend(iconHtml);
                    $('.loader').hide();
                    foldersListHtml.prepend(folderElementHtml);
                }
            } else {
                foldersListHtml.after($('<p/>').html('Error'));
            }
        });

        $('.choose-folder').on('click', function() {
            var folderPath = dialog.showOpenDialog({ properties: [ 'openDirectory']});

            if(folderPath.length > 0){
                addFolder(folderPath[0]);
            }
        });

        $('.folder-input button').on('click', function() {
            ipc.send('add-folders', foldersToAdd);
            $('.loader').show();
            $('#folders-to-add-list').empty();
            return false;
        });

        $('#holder').on("drop", function(event) {
            event.preventDefault();
            event.stopPropagation();
            var folderPath = event.originalEvent.dataTransfer.files[0].path;

            addFolder(folderPath);
        });

        $('.js-refresh-list').on("click", function() {
            ipc.send('refresh-folders', true);
            $('.loader').show();
        })

    </script>

</body>
</html>
