<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Edith Path</title>

    <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,400italic,500,500italic,600,600italic,700,700italic,300italic,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,400italic,500,500italic,600,600italic,700,700italic,300italic,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Material+Icons' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/style.css?version=2.0.1" >
</head>
<body>

    <header class="bg-color-primary altitude-1">
        <h1>Edit-path</h1>
        <!--div class="window-tools bg-color-primary-dark">
            <img src="img/ic_close_white_36dp_1x.png" alt="" />
        </div-->
    </header>

    <section class="altitude-2 add-folders">
        <h2>Choisir un dossier Ã  ajouter au path</h2>

        <ul id="folders-to-add-list">
        </ul>

        <div id="holder" class="holder">
            Faites glisser votre dossier ici pour l'ajouter au path.
        </div>

        <div class="folder-input">
            <button class="btn altitude-1 bg-color-primary-dark">Valider</button>
        </div>
    </section>

    <div class="choose-folder altitude-2"></div>

    <section class="list-path altitude-2">
        <div class="section-header">
            <h2>PATH actuel</h2>
            <div class="refresh-list"></div>
        </div>

        <div class="loader">
            <svg class="circular" viewBox="25 25 50 50">
              <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/>
            </svg>
        </div>

        <ul id="folders-list">
        </ul>
    </section>

    <script type="text/javascript">
        'use strict';

        var ipc = require('ipc');
        var remote = require('remote');
        var dialog = remote.require('dialog');
        var foldersToAdd = [];
        window.$ = window.jQuery = require('jquery');

        document.ondragover = document.ondrop = function(e) {
          e.preventDefault();
          return false;
        };

        function addFolder(path) {
            if(path) {
                foldersToAdd.push(path);

                var folderElementHtml = $('<li/>');
                var iconHtml = $('<i/>')
                    .attr('class', 'md-icon dp48')
                    .html('check_circle');

                folderElementHtml
                    .html(path)
                    .prepend(iconHtml);

                $('#folders-to-add-list').prepend(folderElementHtml);
            }
        }

        ipc.on('data-folders', function(folders) {
            var arrayLength = folders.length;
            var foldersListHtml = $('#folders-list').empty();;

            if(arrayLength > 0) {
                for (var i = 0; i < arrayLength; i++) {
                    var folderElementHtml = $('<li/>');
                    // var iconHtml = $('<i/>')
                    //     .attr('class', 'md-icon dp48');

                    if(folders[i].isValidDirectory) {
                        // iconHtml.html('check_circle');
                        folderElementHtml.attr('class', 'valid-path');
                    } else {
                        // iconHtml.html('error');
                        folderElementHtml.attr('class', 'invalid-path');
                    }

                    folderElementHtml
                        .html(folders[i].path);
                        // .prepend(iconHtml);
                    $('.loader').hide();
                    foldersListHtml.prepend(folderElementHtml);
                }
            } else {
                foldersListHtml.after($('<p/>').html('Error'));
            }
        });

        $('.choose-folder').on('click', function() {
            var folderPath = dialog.showOpenDialog({ properties: [ 'openDirectory']});

            if(folderPath.length > 0){
                addFolder(folderPath[0]);
            }
        });

        $('.folder-input button').on('click', function() {
            ipc.send('add-folders', foldersToAdd);
            $('.loader').show();
            $('#folders-to-add-list').empty();
            return false;
        });

        $('#holder').on("drop", function(event) {
            event.preventDefault();
            event.stopPropagation();
            var folderPath = event.originalEvent.dataTransfer.files[0].path;

            addFolder(folderPath);
        });

        $('.refresh-list').on("click", function() {
            ipc.send('refresh-folders', true);
            $('.loader').show();
        })

    </script>

</body>
</html>

<!--
<html>
<head>
  <title>Electron</title>
  <style>
    body {
      color: #555;
      font-family: 'Open Sans',Helvetica,Arial,sans-serif;
      padding: 30px;
    }

    h2 {
      color: #2b6cc2;
      font-family: "Crimson Text",Georgia,serif;
      font-weight: 400;
      line-height: 1.1;
      letter-spacing: -0.015em;
    }

    a {
      color: #2b6cc2;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    pre, code {
      font-family: "Menlo","Lucida Console",monospace;
      border: 1px solid #ddd;
      background-color: #f8f8f8;
      border-radius: 3px;
    }

    pre {
      white-space: pre-wrap;
      font-size: 13px;
      line-height: 19px;
      overflow: auto;
      padding: 6px 10px;
    }

    #holder {
      border: 4px dashed #ccc;
      margin: 0 auto;
      height: 300px;
      color: #ccc;
      font-size: 40px;
      line-height: 300px;
      text-align: center;
      -webkit-user-select: none;
    }
    #holder.hover {
      border: 4px dashed #999;
      color: #eee;
    }
  </style>
</head>
<body>
  <script>
    var execPath = require('remote').process.execPath;
    var command = execPath + ' path-to-your-app';

    document.onclick = function(e) {
      e.preventDefault();
      if (e.target.tagName == 'A')
        require('shell').openExternal(e.target.href);
      return false;
    };
    document.ondragover = document.ondrop = function(e) {
      e.preventDefault();
      return false;
    };
  </script>

  <h2 style="-webkit-app-region: drag">Welcome to Electron</h2>

  <p>
  To run your app with Electron, execute the following command under your
  Console (or Terminal):
  </p>

  <script>document.write('<pre>' + command + '</pre>')</script>

  <p>
  The <code>path-to-your-app</code> should be the path to your own Electron
  app, you can read the <a href='https://github.com/atom/electron/blob/master/docs/tutorial/quick-start.md'>quick start</a>
  guide in Electron's <a href='https://github.com/atom/electron/blob/master/docs'>docs</a>
  on how to write one.
  </p>

  <p>
  Or you can just drag your app here to run it:
  </p>

  <div id="holder">
    Drag your app here to run it
  </div>

  <script>
    var holder = document.getElementById('holder');
    holder.ondragover = function () {
      this.className = 'hover';
      return false;
    };
    holder.ondragleave = holder.ondragend = function () {
      this.className = '';
      return false;
    };
    holder.ondrop = function (e) {
      this.className = '';
      e.preventDefault();

      var file = e.dataTransfer.files[0];
      require('child_process').execFile(execPath, [file.path], {
        detached: true, stdio: 'ignore'
      }).unref();
      return false;
    };
  </script>
</body>
</html>
